# 10. åˆ†ç±»åŠ è½½æ›´å¤šä¸åŠ è½½ä¸­çŠ¶æ€

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜åˆ†ç±»æ¿å—ä¸­çš„åŠ è½½æ›´å¤šåŠŸèƒ½ä»¥åŠåŠ è½½ä¸­çŠ¶æ€çš„æ˜¾ç¤ºé€»è¾‘ã€‚

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. åˆ†ç±»ç‹¬ç«‹åŠ è½½

æ¯ä¸ªåˆ†ç±»æ¿å—ç‹¬ç«‹ç»´æŠ¤åˆ†é¡µçŠ¶æ€ï¼ŒåŠ è½½æ›´å¤šæ—¶åªåŠ è½½å½“å‰åˆ†ç±»çš„æ–°é—»ã€‚

**ç¤ºä¾‹**ï¼š
- åœ¨"å…¨éƒ¨"æ¿å—ç‚¹å‡»åŠ è½½æ›´å¤š â†’ åŠ è½½æ‰€æœ‰åˆ†ç±»çš„æ–°é—»
- åœ¨"ç§‘æŠ€"æ¿å—ç‚¹å‡»åŠ è½½æ›´å¤š â†’ åªåŠ è½½ç§‘æŠ€ç±»æ–°é—»
- åœ¨"æ•™è‚²"æ¿å—ç‚¹å‡»åŠ è½½æ›´å¤š â†’ åªåŠ è½½æ•™è‚²ç±»æ–°é—»

### 2. åŠ è½½ä¸­çŠ¶æ€æ˜¾ç¤º

ç‚¹å‡»"åŠ è½½æ›´å¤š"åï¼Œç«‹å³æ˜¾ç¤º"åŠ è½½ä¸­..."çŠ¶æ€ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»ã€‚

**çŠ¶æ€æµè½¬**ï¼š
```
"ç‚¹å‡»åŠ è½½æ›´å¤š"ï¼ˆè“è‰²ï¼Œå¯ç‚¹å‡»ï¼‰
  â†“ ç‚¹å‡»
"åŠ è½½ä¸­..."ï¼ˆç°è‰²ï¼Œä¸å¯ç‚¹å‡»ï¼‰
  â†“ åŠ è½½å®Œæˆ
"ç‚¹å‡»åŠ è½½æ›´å¤š"ï¼ˆè“è‰²ï¼Œå¯ç‚¹å‡»ï¼‰
  æˆ–
"å·²åŠ è½½å…¨éƒ¨æ•°æ®"ï¼ˆç°è‰²ï¼Œä¸å¯ç‚¹å‡»ï¼‰
```

---

## ğŸ”Œ åç«¯APIè¦æ±‚

### APIæ¥å£

```java
/**
 * æŒ‰åˆ†ç±»è·å–æ–°é—»åˆ—è¡¨
 * 
 * @param category åˆ†ç±»ä»£ç ï¼ˆnullè¡¨ç¤ºå…¨éƒ¨ï¼‰
 * @param offset åç§»é‡ï¼ˆä»ç¬¬å‡ æ¡å¼€å§‹ï¼‰
 * @param limit æ¯é¡µæ•°é‡
 */
@GET("api/news")
Call<List<NewsItem>> getNewsListByCategory(
    @Query("category") String category,
    @Query("offset") Integer offset,
    @Query("limit") int limit
);
```

### è¯·æ±‚ç¤ºä¾‹

#### 1. åŠ è½½å…¨éƒ¨æ–°é—»ï¼ˆç¬¬ä¸€é¡µï¼‰
```http
GET /api/news?offset=0&limit=10
```

#### 2. åŠ è½½ç§‘æŠ€æ–°é—»ï¼ˆç¬¬ä¸€é¡µï¼‰
```http
GET /api/news?category=tech&offset=0&limit=10
```

#### 3. åŠ è½½ç§‘æŠ€æ–°é—»ï¼ˆç¬¬äºŒé¡µï¼‰
```http
GET /api/news?category=tech&offset=10&limit=10
```

### å“åº”æ ¼å¼

```json
[
  {
    "id": 1,
    "title": "äººå·¥æ™ºèƒ½æŠ€æœ¯å–å¾—é‡å¤§çªç ´",
    "summary": "ç ”ç©¶äººå‘˜å¼€å‘å‡ºæ–°å‹AIæ¨¡å‹...",
    "imageUrl": "http://localhost:8080/images/news1.jpg",
    "publishTime": "2å°æ—¶å‰",
    "readCount": "1.2ä¸‡é˜…è¯»",
    "category": "tech"
  },
  {
    "id": 2,
    "title": "é‡å­è®¡ç®—æœºå®ç°æ–°çªç ´",
    "summary": "ç§‘å­¦å®¶æˆåŠŸç ”åˆ¶å‡ºæ–°å‹é‡å­èŠ¯ç‰‡...",
    "imageUrl": "http://localhost:8080/images/news2.jpg",
    "publishTime": "3å°æ—¶å‰",
    "readCount": "8500é˜…è¯»",
    "category": "tech"
  }
  // ... æ›´å¤šç§‘æŠ€ç±»æ–°é—»
]
```

---

## ğŸ’» å‰ç«¯å®ç°

### 1. çŠ¶æ€ç®¡ç†

```java
// MainActivity.java
private String currentCategory = null;  // å½“å‰é€‰ä¸­çš„åˆ†ç±»
private int currentOffset = 0;          // å½“å‰åç§»é‡
private boolean hasMoreData = true;     // æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®
private boolean isLoadingMore = false;  // æ˜¯å¦æ­£åœ¨åŠ è½½æ›´å¤š

// NewsAdapter.java
private boolean isLoading = false;      // æ˜¯å¦æ˜¾ç¤ºåŠ è½½ä¸­çŠ¶æ€
```

### 2. åŠ è½½æ›´å¤šæµç¨‹

```java
public void loadMoreNews() {
    // 1. æ£€æŸ¥çŠ¶æ€
    if (isLoadingMore || !hasMoreData) {
        return;
    }
    
    // 2. è·å–å½“å‰åˆ†ç±»åç§°ï¼ˆç”¨äºæ—¥å¿—ï¼‰
    String categoryName = currentCategory == null ? "å…¨éƒ¨" : currentCategory;
    Log.d(TAG, "ğŸ“¥ å¼€å§‹åŠ è½½æ›´å¤šã€" + categoryName + "ã€‘æ¿å—çš„æ–°é—»...");
    
    // 3. æ˜¾ç¤ºåŠ è½½ä¸­çŠ¶æ€
    newsAdapter.setLoading(true);
    
    // 4. å‘èµ·ç½‘ç»œè¯·æ±‚
    loadNewsFromServer(true);  // trueè¡¨ç¤ºåŠ è½½æ›´å¤š
}
```

### 3. ç½‘ç»œè¯·æ±‚

```java
private void loadNewsFromServer(boolean isLoadMore) {
    isLoadingMore = isLoadMore;
    
    // æ ¹æ®å½“å‰åˆ†ç±»æ„é€ è¯·æ±‚
    Call<List<NewsItem>> call;
    if (currentCategory == null) {
        // åŠ è½½å…¨éƒ¨æ–°é—»
        call = apiService.getNewsList(currentOffset, PAGE_SIZE);
    } else {
        // åŠ è½½æŒ‡å®šåˆ†ç±»çš„æ–°é—»
        call = apiService.getNewsListByCategory(currentCategory, currentOffset, PAGE_SIZE);
    }
    
    call.enqueue(new Callback<List<NewsItem>>() {
        @Override
        public void onResponse(Call call, Response response) {
            if (response.isSuccessful()) {
                List<NewsItem> newsItems = response.body();
                
                // è¿½åŠ æ•°æ®
                int oldSize = newsList.size();
                newsList.addAll(newsItems);
                newsAdapter.notifyItemRangeInserted(oldSize, newsItems.size());
                
                // æ›´æ–°åˆ†é¡µçŠ¶æ€
                if (newsItems.size() < PAGE_SIZE) {
                    hasMoreData = false;
                    newsAdapter.setHasMoreData(false);
                } else {
                    currentOffset += newsItems.size();
                    hasMoreData = true;
                    newsAdapter.setHasMoreData(true);
                }
            }
            
            // æ¢å¤åŠ è½½ä¸­çŠ¶æ€
            isLoadingMore = false;
            newsAdapter.setLoading(false);
        }
        
        @Override
        public void onFailure(Call call, Throwable t) {
            // æ¢å¤åŠ è½½ä¸­çŠ¶æ€
            isLoadingMore = false;
            newsAdapter.setLoading(false);
        }
    });
}
```

### 4. Adapterä¸­çš„çŠ¶æ€æ˜¾ç¤º

```java
public void bind(OnLoadMoreClickListener listener, boolean hasMoreData, boolean isLoading) {
    if (isLoading) {
        // æ­£åœ¨åŠ è½½
        loadMoreText.setText("åŠ è½½ä¸­...");
        loadMoreText.setTextColor(0xFF999999);  // ç°è‰²
        loadMoreText.setClickable(false);
        itemView.setOnClickListener(null);
    } else if (hasMoreData) {
        // æœ‰æ›´å¤šæ•°æ®
        loadMoreText.setText("ç‚¹å‡»åŠ è½½æ›´å¤š");
        loadMoreText.setTextColor(0xFF2196F3);  // è“è‰²
        loadMoreText.setClickable(true);
        itemView.setOnClickListener(v -> {
            if (listener != null) {
                listener.onLoadMoreClick();
            }
        });
    } else {
        // æ— æ›´å¤šæ•°æ®
        loadMoreText.setText("å·²åŠ è½½å…¨éƒ¨æ•°æ®");
        loadMoreText.setTextColor(0xFF999999);  // ç°è‰²
        loadMoreText.setClickable(false);
        itemView.setOnClickListener(null);
    }
}
```

---

## ğŸ”„ å®Œæ•´äº¤äº’æµç¨‹

### åœºæ™¯1ï¼šç§‘æŠ€æ¿å—åŠ è½½æ›´å¤š

```
1. ç”¨æˆ·ç‚¹å‡»"ç§‘æŠ€"åˆ†ç±»æ ‡ç­¾
   â†“
   currentCategory = "tech"
   currentOffset = 0
   hasMoreData = true
   â†“
2. è¯·æ±‚æœåŠ¡å™¨ï¼šGET /api/news?category=tech&offset=0&limit=10
   â†“
3. æ˜¾ç¤º10æ¡ç§‘æŠ€æ–°é—» + "ç‚¹å‡»åŠ è½½æ›´å¤š"å¡ç‰‡
   â†“
4. ç”¨æˆ·æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œç‚¹å‡»"ç‚¹å‡»åŠ è½½æ›´å¤š"
   â†“
   æ˜¾ç¤º"åŠ è½½ä¸­..."ï¼ˆç°è‰²ï¼Œä¸å¯ç‚¹å‡»ï¼‰
   â†“
5. è¯·æ±‚æœåŠ¡å™¨ï¼šGET /api/news?category=tech&offset=10&limit=10
   â†“
6. è¿½åŠ 10æ¡ç§‘æŠ€æ–°é—»åˆ°åˆ—è¡¨
   â†“
   currentOffset = 20
   â†“
7. æ¢å¤"ç‚¹å‡»åŠ è½½æ›´å¤š"ï¼ˆè“è‰²ï¼Œå¯ç‚¹å‡»ï¼‰
   â†“
8. ç”¨æˆ·ç»§ç»­ç‚¹å‡»åŠ è½½æ›´å¤š
   â†“
9. é‡å¤æ­¥éª¤4-7ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šæ•°æ®
   â†“
10. hasMoreData = false
    æ˜¾ç¤º"å·²åŠ è½½å…¨éƒ¨æ•°æ®"ï¼ˆç°è‰²ï¼Œä¸å¯ç‚¹å‡»ï¼‰
```

### åœºæ™¯2ï¼šåˆ‡æ¢åˆ†ç±»ååŠ è½½æ›´å¤š

```
1. ç”¨æˆ·åœ¨"ç§‘æŠ€"æ¿å—ï¼Œå·²åŠ è½½20æ¡æ–°é—»
   â†“
2. ç”¨æˆ·ç‚¹å‡»"æ•™è‚²"åˆ†ç±»
   â†“
   currentCategory = "education"
   currentOffset = 0         â† é‡ç½®
   hasMoreData = true        â† é‡ç½®
   newsList.clear()          â† æ¸…ç©ºåˆ—è¡¨
   â†“
3. è¯·æ±‚æœåŠ¡å™¨ï¼šGET /api/news?category=education&offset=0&limit=10
   â†“
4. æ˜¾ç¤º10æ¡æ•™è‚²æ–°é—» + "ç‚¹å‡»åŠ è½½æ›´å¤š"
   â†“
5. ç”¨æˆ·ç‚¹å‡»"åŠ è½½æ›´å¤š"
   â†“
   æ˜¾ç¤º"åŠ è½½ä¸­..."
   â†“
6. è¯·æ±‚æœåŠ¡å™¨ï¼šGET /api/news?category=education&offset=10&limit=10
   â†“
7. åªè¿½åŠ æ•™è‚²ç±»æ–°é—»ï¼Œä¸ä¼šæ··å…¥ç§‘æŠ€ç±»æ–°é—»
```

---

## ğŸ¨ UIçŠ¶æ€è¡¨

| çŠ¶æ€ | æ–‡æœ¬ | é¢œè‰² | å¯ç‚¹å‡» | è§¦å‘æ¡ä»¶ |
|------|------|------|--------|---------|
| å¯åŠ è½½ | "ç‚¹å‡»åŠ è½½æ›´å¤š" | è“è‰² #2196F3 | âœ… | hasMoreData=true && isLoading=false |
| åŠ è½½ä¸­ | "åŠ è½½ä¸­..." | ç°è‰² #999999 | âŒ | isLoading=true |
| å·²å®Œæˆ | "å·²åŠ è½½å…¨éƒ¨æ•°æ®" | ç°è‰² #999999 | âŒ | hasMoreData=false && isLoading=false |

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### æµ‹è¯•1ï¼šå…¨éƒ¨æ¿å—åŠ è½½æ›´å¤š

**æ­¥éª¤**ï¼š
1. æ‰“å¼€åº”ç”¨ï¼ˆé»˜è®¤"å…¨éƒ¨"æ¿å—ï¼‰
2. æ»šåŠ¨åˆ°åº•éƒ¨
3. ç‚¹å‡»"ç‚¹å‡»åŠ è½½æ›´å¤š"

**é¢„æœŸ**ï¼š
- âœ… æ˜¾ç¤º"åŠ è½½ä¸­..."
- âœ… è¯·æ±‚ï¼š`GET /api/news?offset=10&limit=10`
- âœ… è¿½åŠ 10æ¡æ–°é—»ï¼ˆæ‰€æœ‰åˆ†ç±»ï¼‰
- âœ… æ¢å¤"ç‚¹å‡»åŠ è½½æ›´å¤š"

### æµ‹è¯•2ï¼šç§‘æŠ€æ¿å—åŠ è½½æ›´å¤š

**æ­¥éª¤**ï¼š
1. ç‚¹å‡»"ç§‘æŠ€"åˆ†ç±»
2. æ»šåŠ¨åˆ°åº•éƒ¨
3. ç‚¹å‡»"ç‚¹å‡»åŠ è½½æ›´å¤š"

**é¢„æœŸ**ï¼š
- âœ… æ˜¾ç¤º"åŠ è½½ä¸­..."
- âœ… è¯·æ±‚ï¼š`GET /api/news?category=tech&offset=10&limit=10`
- âœ… åªè¿½åŠ ç§‘æŠ€æ–°é—»
- âœ… ä¸ä¼šæ··å…¥å…¶ä»–åˆ†ç±»

### æµ‹è¯•3ï¼šå¿«é€Ÿç‚¹å‡»é˜²æŠ–

**æ­¥éª¤**ï¼š
1. å¿«é€Ÿè¿ç»­ç‚¹å‡»"ç‚¹å‡»åŠ è½½æ›´å¤š"2æ¬¡

**é¢„æœŸ**ï¼š
- âœ… åªå‘èµ·1æ¬¡è¯·æ±‚
- âœ… ç¬¬äºŒæ¬¡ç‚¹å‡»æ— æ•ˆï¼ˆå› ä¸ºå·²æ˜¾ç¤º"åŠ è½½ä¸­..."ï¼‰

### æµ‹è¯•4ï¼šåˆ‡æ¢åˆ†ç±»é‡ç½®

**æ­¥éª¤**ï¼š
1. åœ¨"ç§‘æŠ€"æ¿å—åŠ è½½åˆ°ç¬¬äºŒé¡µ
2. åˆ‡æ¢åˆ°"æ•™è‚²"åˆ†ç±»

**é¢„æœŸ**ï¼š
- âœ… offseté‡ç½®ä¸º0
- âœ… åˆ—è¡¨æ¸…ç©º
- âœ… æ˜¾ç¤ºæ•™è‚²ç±»ç¬¬ä¸€é¡µ
- âœ… "ç‚¹å‡»åŠ è½½æ›´å¤š"å¯ç”¨

### æµ‹è¯•5ï¼šåŠ è½½å…¨éƒ¨æ•°æ®

**æ­¥éª¤**ï¼š
1. æŒç»­ç‚¹å‡»"åŠ è½½æ›´å¤š"
2. ç›´åˆ°åç«¯è¿”å›<10æ¡æ•°æ®

**é¢„æœŸ**ï¼š
- âœ… hasMoreDataå˜ä¸ºfalse
- âœ… æ˜¾ç¤º"å·²åŠ è½½å…¨éƒ¨æ•°æ®"
- âœ… æ–‡æœ¬å˜ä¸ºç°è‰²
- âœ… ä¸å¯ç‚¹å‡»

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. é˜²æ­¢é‡å¤åŠ è½½

```java
if (isLoadingMore || !hasMoreData) {
    return;  // æ­£åœ¨åŠ è½½æˆ–æ— æ›´å¤šæ•°æ®æ—¶ï¼Œç›´æ¥è¿”å›
}
```

### 2. åˆ‡æ¢åˆ†ç±»æ—¶é‡ç½®çŠ¶æ€

```java
tabView.setOnClickListener(v -> {
    currentCategory = categoryCode;
    currentOffset = 0;        // é‡ç½®
    hasMoreData = true;       // é‡ç½®
    loadNewsWithCache();
});
```

### 3. åŒæ­¥AdapterçŠ¶æ€

```java
// MainActivityä¸­æ›´æ–°çŠ¶æ€åï¼Œéœ€è¦åŒæ­¥åˆ°Adapter
newsAdapter.setHasMoreData(hasMoreData);
newsAdapter.setLoading(isLoading);
```

### 4. åŠ è½½å®Œæˆåæ¢å¤çŠ¶æ€

```java
// æ— è®ºæˆåŠŸæˆ–å¤±è´¥ï¼Œéƒ½è¦æ¢å¤çŠ¶æ€
isLoadingMore = false;
newsAdapter.setLoading(false);
```

---

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

### 1. çŠ¶æ€åŒæ­¥

MainActivityå’ŒNewsAdapteréœ€è¦ä¿æŒçŠ¶æ€åŒæ­¥ï¼š
- `hasMoreData` - é€šè¿‡ `setHasMoreData()` åŒæ­¥
- `isLoading` - é€šè¿‡ `setLoading()` åŒæ­¥

### 2. åˆ†é¡µè®¡ç®—

```java
// ç¬¬ä¸€é¡µ
offset = 0, limit = 10  â†’ è¿”å› 1-10

// ç¬¬äºŒé¡µ
offset = 10, limit = 10  â†’ è¿”å› 11-20

// ç¬¬ä¸‰é¡µ
offset = 20, limit = 10  â†’ è¿”å› 21-30
```

### 3. æ— æ›´å¤šæ•°æ®åˆ¤æ–­

```java
if (newsItems.size() < PAGE_SIZE) {
    hasMoreData = false;  // è¿”å›æ•°é‡å°‘äºè¯·æ±‚æ•°é‡ï¼Œè¯´æ˜æ²¡æœ‰æ›´å¤šæ•°æ®äº†
}
```

### 4. APIå‚æ•°å¤„ç†

```java
// categoryä¸ºnullæ—¶ï¼Œåç«¯åº”è¿”å›æ‰€æœ‰åˆ†ç±»çš„æ–°é—»
if (currentCategory == null) {
    call = apiService.getNewsList(offset, limit);
} else {
    call = apiService.getNewsListByCategory(currentCategory, offset, limit);
}
```

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

### å‰ç«¯æ–‡ä»¶
- `MainActivity.java` - ä¸»è¦é€»è¾‘
- `NewsAdapter.java` - å¡ç‰‡æ˜¾ç¤º
- `NewsApiService.java` - APIæ¥å£å®šä¹‰

### åç«¯æ–‡ä»¶ï¼ˆéœ€è¦å®ç°ï¼‰
- æ–°é—»APIæ¥å£
- åˆ†ç±»è¿‡æ»¤é€»è¾‘
- åˆ†é¡µæŸ¥è¯¢é€»è¾‘

---

## ğŸš€ æœªæ¥ä¼˜åŒ–

1. **é¢„åŠ è½½** - æ»šåŠ¨åˆ°å€’æ•°ç¬¬3ä¸ªæ—¶å¼€å§‹é¢„åŠ è½½
2. **éª¨æ¶å±** - åŠ è½½ä¸­æ˜¾ç¤ºéª¨æ¶å±è€Œä¸æ˜¯æ–‡æœ¬
3. **ä¸Šæ‹‰åŠ è½½** - æ”¯æŒä¸Šæ‹‰æ‰‹åŠ¿è§¦å‘åŠ è½½æ›´å¤š
4. **åŠ è½½å¤±è´¥é‡è¯•** - åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤º"ç‚¹å‡»é‡è¯•"

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-11-23  
**ç›¸å…³æ–‡æ¡£**: 
- [9.å¤šç§å¡ç‰‡å¸ƒå±€ä¸åˆ é™¤åŠŸèƒ½.md](./9.å¤šç§å¡ç‰‡å¸ƒå±€ä¸åˆ é™¤åŠŸèƒ½.md)
