# 多图片和视频新闻支持 - 功能说明

## 📋 功能概述

在原有单图新闻的基础上，新增支持：
1. **多图新闻**：支持最多3张图片的新闻展示
2. **视频新闻**：使用倒计时模拟视频播放器，支持自动播放和暂停

## 🎯 功能特点

### 多图新闻
- 支持2-3张图片并排显示
- 自动适配图片数量，隐藏空白图片位置
- 标记"多图"标签便于识别

### 视频新闻
- **倒计时模拟播放器**：显示播放进度（MM:SS格式）
- **自动播放**：当视频可见度≥40%时自动播放
- **自动暂停**：当视频可见度<40%时自动暂停
- **手动控制**：点击播放/暂停按钮手动控制
- **播放状态指示**：显示"▶ 播放中"状态
- **视频时长显示**：右下角显示总时长

## 📦 数据库修改

### news表新增字段

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `image_url_2` | VARCHAR(255) | 第二张图片URL |
| `image_url_3` | VARCHAR(255) | 第三张图片URL |
| `media_type` | VARCHAR(20) | 媒体类型：single_image/multi_image/video |
| `video_url` | VARCHAR(255) | 视频URL |
| `video_duration` | INT | 视频时长（秒） |
| `video_cover_url` | VARCHAR(255) | 视频封面URL |

### 媒体类型说明

- `single_image`：单图新闻（默认）
- `multi_image`：多图新闻（2-3张图片）
- `video`：视频新闻

## 🔧 Android代码修改

### 1. NewsItem模型扩展
```java
// 新增字段
private String imageUrl2;        // 第二张图片
private String imageUrl3;        // 第三张图片  
private String mediaType;        // 媒体类型
private String videoUrl;         // 视频地址
private int videoDuration;       // 视频时长
private String videoCoverUrl;    // 视频封面

// 便捷判断方法
public boolean isVideo()         // 是否为视频
public boolean isMultiImage()    // 是否为多图
public int getImageCount()       // 获取图片数量
```

### 2. 新增布局文件

#### item_news_multi_image.xml
- 标题和摘要文本
- 三个并排的ImageView
- "多图"标签

#### item_news_video.xml
- 视频封面ImageView
- 播放按钮
- 倒计时显示容器
- 播放状态指示器
- 视频时长标签

### 3. ViewHolder类

#### MultiImageViewHolder
- 处理多图新闻的显示
- 动态加载1-3张图片
- 自动隐藏空白图片位置

#### VideoViewHolder
- **倒计时模拟播放**：使用CountDownTimer实现
- **可见性监听**：通过ViewTreeObserver监听滚动
- **自动播放逻辑**：
  ```java
  if (可见度 >= 40%) {
      自动开始播放
  } else {
      自动暂停播放
  }
  ```
- **播放状态管理**：跟踪当前播放位置，支持续播

### 4. NewsAdapter修改
- 新增VIEW_TYPE_NEWS_MULTI_IMAGE和VIEW_TYPE_NEWS_VIDEO
- getItemViewType根据mediaType返回对应类型
- onCreateViewHolder创建对应的ViewHolder
- onBindViewHolder绑定数据到对应ViewHolder

## 🎨 UI效果

### 多图新闻卡片
```
┌─────────────────────────┐
│ 【标题】                 │
│ 新闻标题文本...          │
│                         │
│ 【摘要】                 │
│ 新闻摘要内容...          │
│                         │
│ ┌──────┬──────┬──────┐ │
│ │ 图1  │ 图2  │ 图3  │ │
│ └──────┴──────┴──────┘ │
│                         │
│ [多图] 2小时前  1.2万阅读│
└─────────────────────────┘
```

### 视频新闻卡片
```
┌─────────────────────────┐
│ 【标题】                 │
│ 视频新闻标题...          │
│                         │
│ ┌─────────────────────┐ │
│ │                     │ │
│ │    [▶ 播放按钮]      │ │
│ │     或              │ │
│ │    02:45            │ │
│ │   模拟播放中         │ │
│ │                     │ │
│ │              03:25  │ │
│ └─────────────────────┘ │
│                         │
│ 【摘要】                 │
│ 视频内容简介...          │
│                         │
│ [视频] 2小时前  1.2万播放│
└─────────────────────────┘
```

## 📱 使用示例

### 数据库插入示例

```sql
-- 多图新闻（3张图）
INSERT INTO news (title, summary, image_url, image_url_2, image_url_3, media_type, ...) 
VALUES ('多图新闻标题', '摘要', 'url1', 'url2', 'url3', 'multi_image', ...);

-- 视频新闻
INSERT INTO news (title, summary, media_type, video_url, video_duration, video_cover_url, ...) 
VALUES ('视频标题', '摘要', 'video', 'video.mp4', 180, 'cover.jpg', ...);
```

### Android代码使用

```java
// NewsItem会自动识别类型
NewsItem item = new NewsItem(...);
if (item.isVideo()) {
    // 视频类型
} else if (item.isMultiImage()) {
    // 多图类型
}
```

## 🔍 技术亮点

1. **视频模拟播放器**
   - 不需要真实视频文件
   - 使用倒计时实现播放进度
   - 内存占用小，性能优秀

2. **智能自动播放**
   - 基于可见度计算（≥40%触发）
   - 防止多个视频同时播放
   - 滚出屏幕自动暂停

3. **灵活的媒体类型**
   - 向后兼容（默认single_image）
   - 易于扩展新类型
   - 数据库设计合理

## 💡 注意事项

1. **视频URL**：当前使用模拟播放，video_url字段预留但不实际使用
2. **性能优化**：VideoViewHolder在复用时会自动清理倒计时器
3. **图片加载**：使用Glide库，自动处理缓存和错误
4. **可见性计算**：基于GlobalVisibleRect精确计算

## 🚀 后续优化建议

1. 支持真实视频播放（集成ExoPlayer）
2. 添加视频缓存机制
3. 支持更多图片（4+图片网格布局）
4. 添加图片预览功能
5. 视频播放统计上报

---
**文档创建时间**：2025-11-30
**作者**：Cascade AI
**版本**：1.0
