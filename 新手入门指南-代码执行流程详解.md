# ğŸ“š Androidæ–°é—»App - æ–°æ‰‹å…¥é—¨æŒ‡å—

> æœ¬æ–‡æ¡£å°†é€šè¿‡å…·ä½“çš„ä¾‹å­ï¼Œå¸¦ä½ ä¸€æ­¥æ­¥ç†è§£è¿™ä¸ªAndroidæ–°é—»åº”ç”¨çš„ä»£ç æ‰§è¡Œæµç¨‹ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„æ¦‚è§ˆ

```
app/src/main/java/com/example/demo2/
â”œâ”€â”€ MainActivity.java          # ä¸»ç•Œé¢ï¼ˆå…¥å£ï¼‰
â”œâ”€â”€ NewsDetailActivity.java    # æ–°é—»è¯¦æƒ…é¡µï¼ˆæ‰‹æœºæ¨¡å¼ï¼‰
â”œâ”€â”€ NewsItem.java             # æ–°é—»æ•°æ®æ¨¡å‹
â”œâ”€â”€ NewsAdapter.java          # æ–°é—»åˆ—è¡¨é€‚é…å™¨
â”œâ”€â”€ fragment/                 # Fragmentç›®å½•
â”‚   â”œâ”€â”€ NewsListFragment.java    # æ–°é—»åˆ—è¡¨Fragment
â”‚   â””â”€â”€ NewsDetailFragment.java  # æ–°é—»è¯¦æƒ…Fragment
â”œâ”€â”€ adapter/                  # é€‚é…å™¨ç›®å½•
â”‚   â””â”€â”€ CategoryPagerAdapter.java # åˆ†ç±»é¡µé¢é€‚é…å™¨
â”œâ”€â”€ api/                      # ç½‘ç»œè¯·æ±‚
â”‚   â””â”€â”€ ApiClient.java           # APIå®¢æˆ·ç«¯
â””â”€â”€ repository/               # æ•°æ®ä»“åº“
    â””â”€â”€ NewsRepository.java      # æ•°æ®ç®¡ç†å±‚
```

---

## ğŸ¯ ç¤ºä¾‹1ï¼šç‚¹å‡»å¯¼èˆªæ "æ•™è‚²"çš„å®Œæ•´æµç¨‹

### æ‰§è¡Œæµç¨‹å›¾
```
ç”¨æˆ·ç‚¹å‡»"æ•™è‚²"Tab
    â†“
MainActivity.java (setupViewPageræ–¹æ³•)
    â†“
TabLayoutè§¦å‘onTabSelected
    â†“
ViewPager2åˆ‡æ¢é¡µé¢
    â†“
CategoryPagerAdapteråˆ›å»º/æ˜¾ç¤ºFragment
    â†“
NewsListFragment.onCreate()
    â†“
NewsListFragment.loadNews()
    â†“
NewsRepository.getNewsList("education")
    â†“
ApiClientå‘é€HTTPè¯·æ±‚
    â†“
åç«¯è¿”å›æ•™è‚²ç±»æ–°é—»
    â†“
NewsAdapteræ˜¾ç¤ºæ–°é—»åˆ—è¡¨
```

### è¯¦ç»†ä»£ç è§£æ

#### 1ï¸âƒ£ **MainActivity.java** - Tabè®¾ç½®
```java
private void setupViewPager() {
    // åˆ›å»ºåˆ†ç±»åˆ—è¡¨
    List<Category> categories = new ArrayList<>();
    categories.add(new Category("å…¨éƒ¨", null));
    categories.add(new Category("ç§‘æŠ€", "tech"));
    categories.add(new Category("æ•™è‚²", "education")); // ğŸ‘ˆ è¿™é‡Œå®šä¹‰äº†æ•™è‚²åˆ†ç±»
    
    // è®¾ç½®é€‚é…å™¨
    CategoryPagerAdapter adapter = new CategoryPagerAdapter(this, categories);
    viewPager.setAdapter(adapter);
    
    // å…³è”Tabå’ŒViewPager
    new TabLayoutMediator(tabLayout, viewPager, 
        (tab, position) -> {
            tab.setText(categories.get(position).getName());
        }
    ).attach();
}
```

#### 2ï¸âƒ£ **CategoryPagerAdapter.java** - åˆ›å»ºå¯¹åº”Fragment
```java
@Override
public Fragment createFragment(int position) {
    // æ ¹æ®ä½ç½®åˆ›å»ºå¯¹åº”çš„Fragment
    String categoryCode = categories.get(position).getCode();
    return NewsListFragment.newInstance(categoryCode); // ğŸ‘ˆ åˆ›å»ºæ•™è‚²æ–°é—»Fragment
}
```

#### 3ï¸âƒ£ **NewsListFragment.java** - åŠ è½½æ•™è‚²æ–°é—»
```java
public static NewsListFragment newInstance(String category) {
    NewsListFragment fragment = new NewsListFragment();
    Bundle args = new Bundle();
    args.putString(ARG_CATEGORY, category); // ğŸ‘ˆ ä¼ é€’"education"å‚æ•°
    fragment.setArguments(args);
    return fragment;
}

private void loadNews() {
    // è·å–åˆ†ç±»å‚æ•°
    String category = getArguments().getString(ARG_CATEGORY);
    
    // è°ƒç”¨Repositoryè·å–æ•°æ®
    repository.getNewsList(
        category,  // ğŸ‘ˆ "education"
        currentOffset,
        PAGE_SIZE,
        new NewsRepository.NewsCallback() {
            @Override
            public void onSuccess(List<NewsItem> newsItems) {
                // æ›´æ–°åˆ—è¡¨
                newsList.addAll(newsItems);
                adapter.notifyDataSetChanged();
            }
        }
    );
}
```

#### 4ï¸âƒ£ **NewsRepository.java** - å‘èµ·ç½‘ç»œè¯·æ±‚
```java
public void getNewsList(String category, int offset, int limit, NewsCallback callback) {
    // æ ¹æ®åˆ†ç±»é€‰æ‹©API
    Call<List<NewsItem>> call;
    if ("education".equals(category)) {
        call = apiService.getNewsListByCategory("education", offset, limit);
    }
    
    // æ‰§è¡Œè¯·æ±‚
    call.enqueue(new Callback<List<NewsItem>>() {
        public void onResponse(Response<List<NewsItem>> response) {
            callback.onSuccess(response.body());
        }
    });
}
```

---

## ğŸ¯ ç¤ºä¾‹2ï¼šç‚¹å‡»æ–°é—»å¡ç‰‡è·³è½¬è¯¦æƒ…é¡µçš„æµç¨‹

### æ‰§è¡Œæµç¨‹å›¾
```
ç”¨æˆ·ç‚¹å‡»æ–°é—»å¡ç‰‡
    â†“
NewsAdapter.ViewHolder.itemView.onClick
    â†“
NewsAdapter.OnItemClickListener.onItemClick()
    â†“
NewsListFragment.adapter.setOnItemClickListener()
    â†“
NewsListFragment.OnNewsSelectedListener.onNewsSelected()
    â†“
MainActivity.onNewsSelected()
    â†“
åˆ¤æ–­è®¾å¤‡ç±»å‹
    â”œâ”€ æ‰‹æœºï¼šstartActivity(NewsDetailActivity)
    â””â”€ å¹³æ¿ï¼šæ›¿æ¢å³ä¾§Fragment
```

### è¯¦ç»†ä»£ç è§£æ

#### 1ï¸âƒ£ **NewsAdapter.java** - è®¾ç½®ç‚¹å‡»äº‹ä»¶
```java
public class NewsViewHolder extends RecyclerView.ViewHolder {
    public void bind(NewsItem newsItem, OnItemClickListener clickListener) {
        // æ˜¾ç¤ºæ–°é—»å†…å®¹...
        
        // è®¾ç½®ç‚¹å‡»äº‹ä»¶
        itemView.setOnClickListener(v -> {
            if (clickListener != null) {
                clickListener.onItemClick(newsItem); // ğŸ‘ˆ è§¦å‘ç‚¹å‡»äº‹ä»¶
            }
        });
    }
}
```

#### 2ï¸âƒ£ **NewsListFragment.java** - ç›‘å¬ç‚¹å‡»
```java
private void setupRecyclerView() {
    adapter.setOnItemClickListener(newsItem -> {
        // é€šçŸ¥Activity
        if (newsSelectedListener != null) {
            newsSelectedListener.onNewsSelected(newsItem); // ğŸ‘ˆ ä¼ é€’ç»™MainActivity
        }
    });
}
```

#### 3ï¸âƒ£ **MainActivity.java** - å¤„ç†è·³è½¬
```java
@Override
public void onNewsSelected(NewsItem newsItem) {
    if (!isTablet) {
        // ğŸ“± æ‰‹æœºæ¨¡å¼ï¼šå¯åŠ¨æ–°Activity
        Intent intent = new Intent(this, NewsDetailActivity.class);
        intent.putExtra("news_item", newsItem); // ä¼ é€’æ•°æ®
        startActivity(intent);
    } else {
        // ğŸ’» å¹³æ¿æ¨¡å¼ï¼šæ›´æ–°å³ä¾§Fragment
        showNewsDetail(newsItem);
    }
}

private void showNewsDetail(NewsItem newsItem) {
    NewsDetailFragment fragment = NewsDetailFragment.newInstance(newsItem);
    getSupportFragmentManager()
        .beginTransaction()
        .replace(R.id.detail_container, fragment) // ğŸ‘ˆ æ›¿æ¢å³ä¾§å®¹å™¨
        .addToBackStack(null) // åŠ å…¥è¿”å›æ ˆ
        .commit();
}
```

---

## ğŸ¯ ç¤ºä¾‹3ï¼šAndroidå¦‚ä½•é€‰æ‹©æ­£ç¡®çš„å¡ç‰‡æ ·å¼

### å¡ç‰‡ç±»å‹å†³ç­–æµç¨‹
```
NewsItemæ•°æ®
    â†“
NewsAdapter.getItemViewType()
    â†“
åˆ¤æ–­æ–°é—»ç±»å‹
    â”œâ”€ æœ‰è§†é¢‘ â†’ TYPE_VIDEO (2)
    â”œâ”€ å¤šå›¾ç‰‡ â†’ TYPE_MULTI_IMAGE (1)
    â””â”€ å•å›¾/æ— å›¾ â†’ TYPE_SINGLE (0)
    â†“
onCreateViewHolderæ ¹æ®ç±»å‹åŠ è½½å¸ƒå±€
    â”œâ”€ TYPE_VIDEO â†’ item_news_video.xml
    â”œâ”€ TYPE_MULTI_IMAGE â†’ item_news_multi_image.xml
    â””â”€ TYPE_SINGLE â†’ item_news_single.xml
```

### è¯¦ç»†ä»£ç è§£æ

#### 1ï¸âƒ£ **NewsAdapter.java** - å†³å®šå¡ç‰‡ç±»å‹
```java
@Override
public int getItemViewType(int position) {
    // è·å–æ–°é—»é¡¹
    NewsItem item = newsList.get(position);
    
    // æ ¹æ®å†…å®¹å†³å®šç±»å‹
    if (item.getVideoUrl() != null) {
        return TYPE_VIDEO;        // ğŸ‘ˆ è§†é¢‘å¡ç‰‡
    } else if (item.getImageUrl2() != null) {
        return TYPE_MULTI_IMAGE;   // ğŸ‘ˆ å¤šå›¾å¡ç‰‡
    } else {
        return TYPE_SINGLE;        // ğŸ‘ˆ å•å›¾å¡ç‰‡
    }
}
```

#### 2ï¸âƒ£ **åˆ›å»ºå¯¹åº”çš„ViewHolder**
```java
@Override
public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {
    switch (viewType) {
        case TYPE_VIDEO:
            // åŠ è½½è§†é¢‘å¸ƒå±€
            View videoView = inflater.inflate(R.layout.item_news_video, parent, false);
            return new VideoViewHolder(videoView);
            
        case TYPE_MULTI_IMAGE:
            // åŠ è½½å¤šå›¾å¸ƒå±€
            View multiView = inflater.inflate(R.layout.item_news_multi_image, parent, false);
            return new MultiImageViewHolder(multiView);
            
        default:
            // åŠ è½½å•å›¾å¸ƒå±€
            View singleView = inflater.inflate(R.layout.item_news_single, parent, false);
            return new NewsViewHolder(singleView);
    }
}
```

#### 3ï¸âƒ£ **ç»‘å®šæ•°æ®åˆ°ViewHolder**
```java
@Override
public void onBindViewHolder(RecyclerView.ViewHolder holder, int position) {
    NewsItem item = newsList.get(position);
    
    if (holder instanceof VideoViewHolder) {
        // è§†é¢‘å¡ç‰‡ç‰¹æ®Šå¤„ç†
        VideoViewHolder vh = (VideoViewHolder) holder;
        vh.bind(item);
        vh.playButton.setVisibility(View.VISIBLE); // æ˜¾ç¤ºæ’­æ”¾æŒ‰é’®
        
    } else if (holder instanceof MultiImageViewHolder) {
        // å¤šå›¾å¡ç‰‡å¤„ç†
        MultiImageViewHolder vh = (MultiImageViewHolder) holder;
        vh.image1.setImageUrl(item.getImageUrl1());
        vh.image2.setImageUrl(item.getImageUrl2());
        vh.image3.setImageUrl(item.getImageUrl3());
    }
}
```

---

## ğŸ¯ ç¤ºä¾‹4ï¼šå¹³æ¿æ¨¡å¼åŒFragmentæ˜¾ç¤º

### å¹³æ¿å¸ƒå±€ç»“æ„
```xml
<!-- layout-sw600dp/activity_main.xml -->
<!-- sw600dpè¡¨ç¤ºæœ€å°å®½åº¦600dpçš„è®¾å¤‡ï¼ˆå¹³æ¿ï¼‰ -->
<LinearLayout orientation="horizontal">
    <!-- å·¦ä¾§ï¼šæ–°é—»åˆ—è¡¨ï¼ˆå 40%å®½åº¦ï¼‰ -->
    <FrameLayout 
        android:id="@+id/fragment_container"
        android:layout_width="0dp"
        android:layout_weight="2" />
    
    <!-- å³ä¾§ï¼šæ–°é—»è¯¦æƒ…ï¼ˆå 60%å®½åº¦ï¼‰ -->
    <FrameLayout 
        android:id="@+id/detail_container"
        android:layout_width="0dp"
        android:layout_weight="3" />
</LinearLayout>
```

### ä»£ç å®ç°è§£æ

#### 1ï¸âƒ£ **MainActivity.java** - æ£€æµ‹è®¾å¤‡ç±»å‹
```java
private void setupLayout() {
    // æ£€æŸ¥æ˜¯å¦æœ‰è¯¦æƒ…å®¹å™¨ï¼ˆåªæœ‰å¹³æ¿å¸ƒå±€æœ‰ï¼‰
    isTablet = findViewById(R.id.detail_container) != null;
    
    if (isTablet) {
        // å¹³æ¿æ¨¡å¼ï¼šæ˜¾ç¤ºç©ºç™½è¯¦æƒ…é¡µ
        showEmptyDetail();
    }
}
```

#### 2ï¸âƒ£ **Fragmentäº‹åŠ¡è¯­æ³•è§£é‡Š**
```java
private void showNewsDetail(NewsItem newsItem) {
    // åˆ›å»ºè¯¦æƒ…Fragment
    NewsDetailFragment fragment = NewsDetailFragment.newInstance(newsItem);
    
    // å¼€å§‹Fragmentäº‹åŠ¡
    getSupportFragmentManager()  // è·å–Fragmentç®¡ç†å™¨
        .beginTransaction()       // å¼€å§‹ä¸€ä¸ªäº‹åŠ¡
        .replace(                 // æ›¿æ¢æ“ä½œ
            R.id.detail_container,    // ç›®æ ‡å®¹å™¨ID
            fragment                  // æ–°çš„Fragment
        )
        .addToBackStack(null)     // åŠ å…¥è¿”å›æ ˆï¼ˆå¯ä»¥æŒ‰è¿”å›é”®è¿”å›ï¼‰
        .commit();                // æäº¤äº‹åŠ¡
}
```

#### 3ï¸âƒ£ **Fragmenté€šä¿¡æœºåˆ¶**
```java
// Fragment â†’ Activity é€šä¿¡
public interface OnNewsSelectedListener {
    void onNewsSelected(NewsItem newsItem);
}

// Fragmentä¸­
@Override
public void onAttach(Context context) {
    super.onAttach(context);
    // è·å–Activityçš„å¼•ç”¨
    if (context instanceof OnNewsSelectedListener) {
        listener = (OnNewsSelectedListener) context;
    }
}

// Activityå®ç°æ¥å£
public class MainActivity implements NewsListFragment.OnNewsSelectedListener {
    @Override
    public void onNewsSelected(NewsItem newsItem) {
        // å¤„ç†Fragmentä¼ æ¥çš„äº‹ä»¶
    }
}
```

---

## ğŸ¯ ç¤ºä¾‹5ï¼šå¹³æ¿æ¨¡å¼è¿”å›æ ˆå®ç°

### è¿”å›æ ˆå·¥ä½œåŸç†
```
ç”¨æˆ·æ“ä½œå†å²ï¼š
æ–°é—»A â†’ æ–°é—»B â†’ æ–°é—»C
    â†“
Fragmentè¿”å›æ ˆï¼š
[NewsDetailFragment A]
[NewsDetailFragment B]  
[NewsDetailFragment C] â† æ ˆé¡¶ï¼ˆå½“å‰æ˜¾ç¤ºï¼‰
    â†“
æŒ‰è¿”å›é”®
    â†“
å¼¹å‡ºæ ˆé¡¶ï¼Œæ˜¾ç¤ºB
```

### ä»£ç å®ç°è§£æ

#### 1ï¸âƒ£ **æ·»åŠ åˆ°è¿”å›æ ˆ**
```java
private void showNewsDetail(NewsItem newsItem) {
    FragmentManager manager = getSupportFragmentManager();
    
    // é™åˆ¶è¿”å›æ ˆæ·±åº¦ï¼ˆé˜²æ­¢å†…å­˜æº¢å‡ºï¼‰
    if (manager.getBackStackEntryCount() > 10) {
        // ç§»é™¤æœ€æ—©çš„è®°å½•
        manager.popBackStackImmediate(
            manager.getBackStackEntryAt(0).getId(),
            FragmentManager.POP_BACK_STACK_INCLUSIVE
        );
    }
    
    // æ·»åŠ æ–°çš„Fragmentåˆ°è¿”å›æ ˆ
    manager.beginTransaction()
        .replace(R.id.detail_container, fragment)
        .addToBackStack("news_" + newsItem.getId()) // ğŸ‘ˆ å…³é”®ï¼šåŠ å…¥è¿”å›æ ˆ
        .commit();
}
```

#### 2ï¸âƒ£ **å¤„ç†è¿”å›é”®**
```java
@Override
public void onBackPressed() {
    if (isTablet) {
        FragmentManager manager = getSupportFragmentManager();
        
        // æ£€æŸ¥è¿”å›æ ˆæ˜¯å¦æœ‰å†…å®¹
        if (manager.getBackStackEntryCount() > 0) {
            // å¼¹å‡ºæ ˆé¡¶Fragmentï¼ˆè¿”å›ä¸Šä¸€ä¸ªæ–°é—»ï¼‰
            manager.popBackStack();
            
            // å¦‚æœæ ˆç©ºäº†ï¼Œæ˜¾ç¤ºç©ºç™½é¡µ
            if (manager.getBackStackEntryCount() == 1) {
                showEmptyDetail();
            }
        } else {
            // æ²¡æœ‰å†å²è®°å½•ï¼Œé€€å‡ºåº”ç”¨
            super.onBackPressed();
        }
    } else {
        // æ‰‹æœºæ¨¡å¼ï¼šæ­£å¸¸è¿”å›
        super.onBackPressed();
    }
}
```

#### 3ï¸âƒ£ **Fragmentç”Ÿå‘½å‘¨æœŸ**
```java
// Fragmentè¢«æ·»åŠ åˆ°è¿”å›æ ˆæ—¶çš„ç”Ÿå‘½å‘¨æœŸ
NewsDetailFragment A åˆ›å»º
    onAttach() â†’ onCreate() â†’ onCreateView() â†’ onResume()
    â†“
ç”¨æˆ·ç‚¹å‡»æ–°é—»B
    â†“
NewsDetailFragment A: onPause() â†’ onStop()
NewsDetailFragment B: onCreate() â†’ onCreateView() â†’ onResume()
    â†“
ç”¨æˆ·æŒ‰è¿”å›é”®
    â†“
NewsDetailFragment B: onPause() â†’ onStop() â†’ onDestroy()
NewsDetailFragment A: onStart() â†’ onResume()
```

---

## ğŸ”° æ–°æ‰‹å­¦ä¹ å»ºè®®

### 1. é˜…è¯»é¡ºåº
1. å…ˆçœ‹ `MainActivity.java` - äº†è§£æ•´ä½“ç»“æ„
2. å†çœ‹ `NewsListFragment.java` - ç†è§£åˆ—è¡¨é€»è¾‘
3. ç„¶å `NewsAdapter.java` - å­¦ä¹ RecyclerViewç”¨æ³•
4. æœ€å `NewsRepository.java` - ç†è§£æ•°æ®è·å–

### 2. è°ƒè¯•æŠ€å·§
```java
// åœ¨å…³é”®ä½ç½®æ·»åŠ æ—¥å¿—
Log.d("DEBUG", "å½“å‰ä½ç½®ï¼šMainActivity.onNewsSelected");
Log.d("DEBUG", "æ–°é—»æ ‡é¢˜ï¼š" + newsItem.getTitle());
```

### 3. é‡è¦æ¦‚å¿µ
- **Fragment**ï¼šå¯é‡ç”¨çš„UIç»„ä»¶ï¼Œåƒé¡µé¢ä¸­çš„å°é¡µé¢
- **Adapter**ï¼šè¿æ¥æ•°æ®å’ŒUIçš„æ¡¥æ¢
- **ViewHolder**ï¼šä¼˜åŒ–åˆ—è¡¨æ€§èƒ½çš„è®¾è®¡æ¨¡å¼
- **Repository**ï¼šæ•°æ®ç®¡ç†å±‚ï¼Œéš”ç¦»æ•°æ®æº
- **å›è°ƒæ¥å£**ï¼šç»„ä»¶é—´é€šä¿¡çš„æ–¹å¼

### 4. å­¦ä¹ èµ„æº
- Androidå®˜æ–¹æ–‡æ¡£ï¼šhttps://developer.android.com
- FragmentæŒ‡å—ï¼šhttps://developer.android.com/guide/fragments
- RecyclerViewæ•™ç¨‹ï¼šhttps://developer.android.com/guide/topics/ui/layout/recyclerview

---

## ğŸ“ æ€»ç»“

è¿™ä¸ªæ–°é—»Appçš„æ ¸å¿ƒæµç¨‹æ˜¯ï¼š
1. **MainActivity** ä½œä¸ºæ€»æ§åˆ¶å™¨
2. **Fragment** è´Ÿè´£å…·ä½“åŠŸèƒ½æ¨¡å—
3. **Adapter** ç®¡ç†åˆ—è¡¨æ˜¾ç¤º
4. **Repository** å¤„ç†æ•°æ®è·å–
5. é€šè¿‡**æ¥å£å›è°ƒ**å®ç°ç»„ä»¶é€šä¿¡

ç†è§£äº†è¿™äº›åŸºæœ¬æ¦‚å¿µå’Œæµç¨‹ï¼Œä½ å°±èƒ½çœ‹æ‡‚å¤§éƒ¨åˆ†Androidåº”ç”¨çš„ä»£ç äº†ï¼

---

ğŸ’¡ **æç¤º**ï¼šå»ºè®®æ‰“å¼€Android Studioï¼Œè®¾ç½®æ–­ç‚¹ï¼Œä¸€æ­¥æ­¥è°ƒè¯•æŸ¥çœ‹æ‰§è¡Œæµç¨‹ï¼Œè¿™æ ·ç†è§£ä¼šæ›´æ·±åˆ»ã€‚
