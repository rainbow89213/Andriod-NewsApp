# æ•°æ®åº“é›†æˆè¯´æ˜ - æ›´æ–°ç‰ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•é›†æˆMySQLæ•°æ®åº“åˆ°æ–°é—»åº”ç”¨é¡¹ç›®ä¸­ï¼Œ**å·²æ›´æ–°æ”¯æŒå¤šå›¾ç‰‡å’Œè§†é¢‘æ–°é—»åŠŸèƒ½**ã€‚

### ğŸ†• æ–°å¢åŠŸèƒ½
- âœ… **å¤šå›¾æ–°é—»**ï¼šæ”¯æŒ2-3å¼ å›¾ç‰‡çš„æ–°é—»å±•ç¤º
- âœ… **è§†é¢‘æ–°é—»**ï¼šæ”¯æŒè§†é¢‘URLã€æ—¶é•¿ã€å°é¢ç­‰ä¿¡æ¯
- âœ… **åª’ä½“ç±»å‹è¯†åˆ«**ï¼šé€šè¿‡`media_type`å­—æ®µåŒºåˆ†ä¸åŒç±»å‹æ–°é—»

---

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### æ•°æ®åº“ä¿¡æ¯
- **æ•°æ®åº“å**: `news_db`
- **å­—ç¬¦é›†**: `utf8mb4`
- **æ’åºè§„åˆ™**: `utf8mb4_unicode_ci`

### è¡¨ç»“æ„

#### 1. userè¡¨ï¼ˆç”¨æˆ·è¡¨ï¼‰
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | INT PRIMARY KEY | ç”¨æˆ·ID |
| username | VARCHAR(50) | ç”¨æˆ·å |
| nickname | VARCHAR(100) | æ˜µç§° |
| avatar | VARCHAR(255) | å¤´åƒURL |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ |

#### 2. categoryè¡¨ï¼ˆåˆ†ç±»è¡¨ï¼‰
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | INT PRIMARY KEY | åˆ†ç±»ID |
| name | VARCHAR(50) | åˆ†ç±»åç§° |
| code | VARCHAR(20) | åˆ†ç±»ä»£ç  |
| description | TEXT | åˆ†ç±»æè¿° |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ |

#### 3. newsè¡¨ï¼ˆæ–°é—»è¡¨ï¼‰- **å·²æ›´æ–°**
| å­—æ®µå | ç±»å‹ | è¯´æ˜ | æ–°å¢ |
|--------|------|------|------|
| id | INT PRIMARY KEY | æ–°é—»ID | |
| title | VARCHAR(255) | æ–°é—»æ ‡é¢˜ | |
| summary | TEXT | æ–°é—»æ‘˜è¦ | |
| image_url | VARCHAR(255) | ä¸»å›¾ç‰‡URL | |
| **image_url_2** | **VARCHAR(255)** | **ç¬¬äºŒå¼ å›¾ç‰‡URL** | **ğŸ†•** |
| **image_url_3** | **VARCHAR(255)** | **ç¬¬ä¸‰å¼ å›¾ç‰‡URL** | **ğŸ†•** |
| **media_type** | **VARCHAR(20)** | **åª’ä½“ç±»å‹** | **ğŸ†•** |
| **video_url** | **VARCHAR(255)** | **è§†é¢‘URL** | **ğŸ†•** |
| **video_duration** | **INT** | **è§†é¢‘æ—¶é•¿(ç§’)** | **ğŸ†•** |
| **video_cover_url** | **VARCHAR(255)** | **è§†é¢‘å°é¢URL** | **ğŸ†•** |
| category_id | INT | åˆ†ç±»IDï¼ˆå¤–é”®ï¼‰ | |
| user_id | INT | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ | |
| read_count | INT | é˜…è¯»æ•° | |
| publish_time | TIMESTAMP | å‘å¸ƒæ—¶é—´ | |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | |

### ğŸ†• åª’ä½“ç±»å‹è¯´æ˜

| media_typeå€¼ | è¯´æ˜ | ä½¿ç”¨å­—æ®µ |
|-------------|------|---------|
| `single_image` | å•å›¾æ–°é—»ï¼ˆé»˜è®¤ï¼‰ | image_url |
| `multi_image` | å¤šå›¾æ–°é—» | image_url, image_url_2, image_url_3 |
| `video` | è§†é¢‘æ–°é—» | video_url, video_duration, video_cover_url |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

**å¿…éœ€è½¯ä»¶**:
- MySQL 5.7+ æˆ– MySQL 8.0+
- Java 8+
- Maven 3.6+

**æ£€æŸ¥MySQLæœåŠ¡**:
```powershell
# æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
Get-Service MySQL*

# å¦‚æœæœªå¯åŠ¨ï¼Œå¯åŠ¨æœåŠ¡
net start MySQL80
```

### 2. æ•°æ®åº“åˆå§‹åŒ–

**æ–¹å¼ä¸€ï¼šä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬ï¼ˆæ¨èï¼‰**

```powershell
# è¿›å…¥é¡¹ç›®ç›®å½•
cd d:\Gradetwo\andriod\demo2\newsApp

# è¿è¡Œåˆå§‹åŒ–è„šæœ¬
init_database.bat
```

**æ–¹å¼äºŒï¼šæ‰‹åŠ¨æ‰§è¡Œ**

```powershell
# 1. è¿æ¥MySQL
mysql -u root -p

# 2. åˆ›å»ºæ•°æ®åº“
CREATE DATABASE IF NOT EXISTS news_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 3. ä½¿ç”¨æ•°æ®åº“
USE news_db;

# 4. æ‰§è¡Œå»ºè¡¨è„šæœ¬
source d:/Gradetwo/andriod/demo2/newsApp/src/main/resources/schema.sql

# 5. æ’å…¥æµ‹è¯•æ•°æ®
source d:/Gradetwo/andriod/demo2/newsApp/src/main/resources/data.sql
```

### 3. éªŒè¯å®‰è£…

```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
SHOW TABLES;

-- æ£€æŸ¥æ–°é—»æ•°æ®
SELECT id, title, media_type, 
       CASE 
           WHEN media_type = 'video' THEN CONCAT('è§†é¢‘(', video_duration, 's)')
           WHEN media_type = 'multi_image' THEN 'å¤šå›¾'
           ELSE 'å•å›¾'
       END as ç±»å‹
FROM news 
LIMIT 10;

-- ç»Ÿè®¡å„ç±»å‹æ–°é—»æ•°é‡
SELECT media_type, COUNT(*) as æ•°é‡ 
FROM news 
GROUP BY media_type;
```

---

## ğŸ”§ é…ç½®æ–‡ä»¶

### application.yml
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/news_db?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: ä½ çš„MySQLå¯†ç 
    driver-class-name: com.mysql.cj.jdbc.Driver
    
  # æ•°æ®åº“è¿æ¥æ± é…ç½®
  hikari:
    maximum-pool-size: 10
    minimum-idle: 5
    connection-timeout: 30000
    idle-timeout: 600000
    max-lifetime: 1800000

# MyBatisé…ç½®
mybatis:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.example.newsapp.model
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

# æœåŠ¡å™¨é…ç½®
server:
  port: 8080
  servlet:
    context-path: /

# æ—¥å¿—é…ç½®
logging:
  level:
    com.example.newsapp.mapper: DEBUG
    org.springframework.web: INFO
```

---

## ğŸ“¡ APIæ¥å£

### ğŸ†• æ›´æ–°åçš„å“åº”æ ¼å¼

```json
[
  {
    "title": "äººå·¥æ™ºèƒ½æŠ€æœ¯å–å¾—é‡å¤§çªç ´",
    "summary": "æœ€æ–°ç ”ç©¶è¡¨æ˜ï¼Œæ·±åº¦å­¦ä¹ ç®—æ³•åœ¨å›¾åƒè¯†åˆ«é¢†åŸŸè¾¾åˆ°äº†æ–°çš„é‡Œç¨‹ç¢‘...",
    "imageUrl": "https://picsum.photos/400/200?random=1",
    "imageUrl2": null,
    "imageUrl3": null,
    "mediaType": "single_image",
    "videoUrl": null,
    "videoDuration": 0,
    "videoCoverUrl": null,
    "publishTime": "2025-11-30 21:25:30",
    "readCount": "1.2ä¸‡é˜…è¯»"
  },
  {
    "title": "çƒ­é—¨ç»¼è‰ºèŠ‚ç›®æ”¶è§†ç‡åˆ›æ–°é«˜ã€ä¸‰å›¾ã€‘",
    "summary": "æœ€æ–°ä¸€æœŸç»¼è‰ºèŠ‚ç›®æ”¶è§†ç‡çªç ´3%ï¼Œæˆä¸ºæœ¬å¹´åº¦æ”¶è§†å† å†›...",
    "imageUrl": "https://picsum.photos/400/200?random=51",
    "imageUrl2": "https://picsum.photos/400/200?random=511",
    "imageUrl3": "https://picsum.photos/400/200?random=512",
    "mediaType": "multi_image",
    "videoUrl": null,
    "videoDuration": 0,
    "videoCoverUrl": null,
    "publishTime": "2025-11-29 21:25:30",
    "readCount": "15.6ä¸‡é˜…è¯»"
  },
  {
    "title": "çŸ¥åå¯¼æ¼”æ–°ç‰‡è·å›½é™…å¤§å¥–ã€è§†é¢‘ã€‘",
    "summary": "åœ¨åˆšåˆšç»“æŸçš„å›½é™…ç”µå½±èŠ‚ä¸Šï¼Œåè¯­å¯¼æ¼”çš„æœ€æ–°ä½œå“æ–©è·æœ€ä½³å½±ç‰‡å¥–...",
    "imageUrl": null,
    "imageUrl2": null,
    "imageUrl3": null,
    "mediaType": "video",
    "videoUrl": "https://example.com/movie-video.mp4",
    "videoDuration": 210,
    "videoCoverUrl": "https://picsum.photos/400/200?random=5",
    "publishTime": "2025-11-29 21:25:30",
    "readCount": "23.4ä¸‡æ’­æ”¾"
  }
]
```

### APIç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | å‚æ•° |
|------|------|------|------|
| GET | `/api/news` | è·å–æ–°é—»åˆ—è¡¨ | category, offset, limit |
| GET | `/api/news/{id}` | è·å–æ–°é—»è¯¦æƒ… | id |
| GET | `/api/categories` | è·å–åˆ†ç±»åˆ—è¡¨ | æ—  |

### è¯·æ±‚ç¤ºä¾‹

```bash
# 1. è·å–æ‰€æœ‰æ–°é—»ï¼ˆåŒ…å«å¤šåª’ä½“ç±»å‹ï¼‰
curl http://localhost:8080/api/news

# 2. è·å–ç§‘æŠ€åˆ†ç±»æ–°é—»
curl http://localhost:8080/api/news?category=tech

# 3. åˆ†é¡µæŸ¥è¯¢ï¼ˆè·³è¿‡å‰10æ¡ï¼Œè·å–5æ¡ï¼‰
curl http://localhost:8080/api/news?offset=10&limit=5

# 4. è·å–è§†é¢‘æ–°é—»ï¼ˆé€šè¿‡ç­›é€‰ï¼‰
curl "http://localhost:8080/api/news" | jq '.[] | select(.mediaType == "video")'

# 5. è·å–å¤šå›¾æ–°é—»
curl "http://localhost:8080/api/news" | jq '.[] | select(.mediaType == "multi_image")'
```

---

## ğŸ—‚ï¸ æ•°æ®ç»Ÿè®¡

### ğŸ†• æ›´æ–°åçš„é¢„ç½®æ•°æ®

#### æ€»ä½“ç»Ÿè®¡
- **ç”¨æˆ·**: 8ä¸ªï¼ˆæ¯ä¸ªåˆ†ç±»1ä¸ªä¸“ä¸šç”¨æˆ·ï¼‰
- **åˆ†ç±»**: 8ä¸ªï¼ˆç§‘æŠ€ã€ç»æµã€ä½“è‚²ã€å¥åº·ã€å¨±ä¹ã€æ•™è‚²ã€ç¯ä¿ã€ç¾é£Ÿï¼‰
- **æ–°é—»**: çº¦60æ¡ï¼ˆåŒ…å«æ‰©å±•æ•°æ®ï¼‰

#### åª’ä½“ç±»å‹åˆ†å¸ƒ
| åª’ä½“ç±»å‹ | æ•°é‡ | å æ¯” | ç¤ºä¾‹ |
|---------|------|------|------|
| single_image | ~40æ¡ | 67% | ä¼ ç»Ÿå•å›¾æ–°é—» |
| multi_image | ~12æ¡ | 20% | ã€åŒå›¾ã€‘ã€ä¸‰å›¾ã€‘æ–°é—» |
| video | ~8æ¡ | 13% | ã€è§†é¢‘ã€‘æ–°é—» |

#### åˆ†ç±»æ•°æ®ç¤ºä¾‹

**ç§‘æŠ€åˆ†ç±»**:
- å•å›¾ï¼šAIæŠ€æœ¯çªç ´ã€5Gç½‘ç»œè¦†ç›–ç­‰
- å¤šå›¾ï¼šæ™ºèƒ½å®¶å±…å±•ç¤ºã€èŠ¯ç‰‡äº§ä¸šå‘å±•
- è§†é¢‘ï¼šæ–°å“å‘å¸ƒä¼šã€æŠ€æœ¯æ¼”ç¤º

**å¨±ä¹åˆ†ç±»**:
- å•å›¾ï¼šéŸ³ä¹èŠ‚é—¨ç¥¨å”®ç½„
- å¤šå›¾ï¼šç»¼è‰ºèŠ‚ç›®æ”¶è§†åˆ›æ–°é«˜ã€ä¸‰å›¾ã€‘
- è§†é¢‘ï¼šå¯¼æ¼”æ–°ç‰‡è·å¥–ã€è§†é¢‘ã€‘

**æ•™è‚²åˆ†ç±»**:
- å•å›¾ï¼šä¼ ç»Ÿæ•™è‚²æ–°é—»
- å¤šå›¾ï¼šåœ¨çº¿æ•™è‚²å¹³å°ã€åŒå›¾ã€‘ã€èŒä¸šæ•™è‚²ã€ä¸‰å›¾ã€‘
- è§†é¢‘ï¼šé«˜è€ƒæ”¹é©æ–¹æ¡ˆã€è§†é¢‘ã€‘

### ğŸ†• æ–°å¢æ•°æ®ç‰¹ç‚¹

1. **æ ‡é¢˜æ ‡è¯†**ï¼šå¤šåª’ä½“æ–°é—»æ ‡é¢˜å¸¦æœ‰ç±»å‹æ ‡è¯†
   - `ã€åŒå›¾ã€‘`ï¼š2å¼ å›¾ç‰‡
   - `ã€ä¸‰å›¾ã€‘`ï¼š3å¼ å›¾ç‰‡
   - `ã€è§†é¢‘ã€‘`ï¼šè§†é¢‘å†…å®¹

2. **è§†é¢‘æ—¶é•¿**ï¼šæ¨¡æ‹ŸçœŸå®è§†é¢‘æ—¶é•¿
   - çŸ­è§†é¢‘ï¼š60-120ç§’
   - ä¸­ç­‰è§†é¢‘ï¼š120-180ç§’
   - é•¿è§†é¢‘ï¼š180-300ç§’

3. **å›¾ç‰‡URL**ï¼šä½¿ç”¨picsum.photosæä¾›éšæœºå›¾ç‰‡
   - ä¸»å›¾ï¼š`random=X`
   - ç¬¬äºŒå¼ ï¼š`random=X1`
   - ç¬¬ä¸‰å¼ ï¼š`random=X2`

---

## ğŸ”§ MyBatisæ˜ å°„æ›´æ–°

### NewsMapper.xml æ–°å¢å­—æ®µ

```xml
<!-- ğŸ†• æ›´æ–°åçš„ç»“æœæ˜ å°„ -->
<resultMap id="NewsItemResultMap" type="com.example.newsapp.model.NewsItem">
    <result column="title" property="title"/>
    <result column="summary" property="summary"/>
    <result column="image_url" property="imageUrl"/>
    <!-- ğŸ†• æ–°å¢å¤šåª’ä½“å­—æ®µæ˜ å°„ -->
    <result column="image_url_2" property="imageUrl2"/>
    <result column="image_url_3" property="imageUrl3"/>
    <result column="media_type" property="mediaType"/>
    <result column="video_url" property="videoUrl"/>
    <result column="video_duration" property="videoDuration"/>
    <result column="video_cover_url" property="videoCoverUrl"/>
    <!-- åŸæœ‰å­—æ®µ -->
    <result column="publish_time" property="publishTime"/>
    <result column="read_count" property="readCount"/>
</resultMap>

<!-- ğŸ†• æ›´æ–°åçš„æŸ¥è¯¢è¯­å¥ -->
<select id="findAllNews" resultMap="NewsItemResultMap">
    SELECT 
        n.title,
        n.summary,
        n.image_url,
        n.image_url_2,      -- ğŸ†•
        n.image_url_3,      -- ğŸ†•
        n.media_type,       -- ğŸ†•
        n.video_url,        -- ğŸ†•
        n.video_duration,   -- ğŸ†•
        n.video_cover_url,  -- ğŸ†•
        DATE_FORMAT(n.publish_time, '%Y-%m-%d %H:%i:%s') as publish_time,
        CASE 
            WHEN n.read_count >= 10000 THEN CONCAT(ROUND(n.read_count/10000, 1), 'ä¸‡', 
                CASE WHEN n.media_type = 'video' THEN 'æ’­æ”¾' ELSE 'é˜…è¯»' END)
            ELSE CONCAT(n.read_count, 
                CASE WHEN n.media_type = 'video' THEN 'æ’­æ”¾' ELSE 'é˜…è¯»' END)
        END as read_count
    FROM news n
    LEFT JOIN category c ON n.category_id = c.id
    LEFT JOIN user u ON n.user_id = u.id
    <where>
        <if test="categoryCode != null and categoryCode != ''">
            AND c.code = #{categoryCode}
        </if>
    </where>
    ORDER BY n.publish_time DESC
    <if test="limit != null and offset != null">
        LIMIT #{offset}, #{limit}
    </if>
</select>
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. æ•°æ®å®Œæ•´æ€§æµ‹è¯•

```sql
-- æ£€æŸ¥åª’ä½“ç±»å‹åˆ†å¸ƒ
SELECT 
    media_type,
    COUNT(*) as æ•°é‡,
    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM news), 2) as å æ¯”
FROM news 
GROUP BY media_type;

-- æ£€æŸ¥å¤šå›¾æ–°é—»çš„å›¾ç‰‡å®Œæ•´æ€§
SELECT 
    title,
    CASE 
        WHEN image_url IS NOT NULL THEN 1 ELSE 0 END +
        CASE WHEN image_url_2 IS NOT NULL THEN 1 ELSE 0 END +
        CASE WHEN image_url_3 IS NOT NULL THEN 1 ELSE 0 END as å›¾ç‰‡æ•°é‡
FROM news 
WHERE media_type = 'multi_image';

-- æ£€æŸ¥è§†é¢‘æ–°é—»çš„å­—æ®µå®Œæ•´æ€§
SELECT 
    title,
    video_duration,
    CASE 
        WHEN video_url IS NOT NULL THEN 'âœ“' ELSE 'âœ—' END as è§†é¢‘URL,
        CASE WHEN video_cover_url IS NOT NULL THEN 'âœ“' ELSE 'âœ—' END as å°é¢URL
FROM news 
WHERE media_type = 'video';
```

### 2. APIå“åº”æµ‹è¯•

```bash
# æµ‹è¯•å¤šåª’ä½“æ–°é—»API
curl -s http://localhost:8080/api/news | jq '
  .[] | {
    title: .title,
    type: .mediaType,
    images: (if .mediaType == "multi_image" then 
      [.imageUrl, .imageUrl2, .imageUrl3] | map(select(. != null)) | length
    else null end),
    videoDuration: (if .mediaType == "video" then .videoDuration else null end)
  }
'
```

### 3. æ€§èƒ½æµ‹è¯•

```sql
-- æŸ¥è¯¢æ€§èƒ½æµ‹è¯•
EXPLAIN SELECT * FROM news WHERE media_type = 'video';
EXPLAIN SELECT * FROM news WHERE category_id = 1 AND media_type = 'multi_image';

-- å»ºè®®æ·»åŠ ç´¢å¼•
CREATE INDEX idx_news_media_type ON news(media_type);
CREATE INDEX idx_news_category_media ON news(category_id, media_type);
```

---

## ğŸš¨ å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šæ–°å­—æ®µè¿”å›null

**ç°è±¡**ï¼šAPIè¿”å›çš„å¤šåª’ä½“å­—æ®µéƒ½æ˜¯null

**åŸå› **ï¼š
1. æ•°æ®åº“å­—æ®µæœªæ­£ç¡®æ·»åŠ 
2. MyBatisæ˜ å°„é…ç½®é”™è¯¯
3. ç¼“å­˜é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
```sql
-- 1. æ£€æŸ¥è¡¨ç»“æ„
DESCRIBE news;

-- 2. æ£€æŸ¥æ•°æ®
SELECT media_type, image_url_2, video_url FROM news LIMIT 5;

-- 3. é‡å¯åº”ç”¨æ¸…é™¤ç¼“å­˜
```

### é—®é¢˜2ï¼šåª’ä½“ç±»å‹è¯†åˆ«é”™è¯¯

**ç°è±¡**ï¼šAndroidç«¯æ— æ³•æ­£ç¡®è¯†åˆ«åª’ä½“ç±»å‹

**åŸå› **ï¼š`media_type`å­—æ®µå€¼ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**ï¼š
```sql
-- æ£€æŸ¥åª’ä½“ç±»å‹å€¼
SELECT DISTINCT media_type FROM news;

-- åº”è¯¥è¿”å›ï¼šsingle_image, multi_image, video
-- å¦‚æœæœ‰å…¶ä»–å€¼ï¼Œéœ€è¦ä¿®æ­£ï¼š
UPDATE news SET media_type = 'single_image' WHERE media_type IS NULL OR media_type = '';
```

### é—®é¢˜3ï¼šè§†é¢‘æ—¶é•¿æ˜¾ç¤ºå¼‚å¸¸

**ç°è±¡**ï¼šè§†é¢‘æ—¶é•¿ä¸º0æˆ–è´Ÿæ•°

**è§£å†³æ–¹æ¡ˆ**ï¼š
```sql
-- æ£€æŸ¥è§†é¢‘æ—¶é•¿æ•°æ®
SELECT title, video_duration FROM news WHERE media_type = 'video';

-- ä¿®æ­£å¼‚å¸¸æ•°æ®
UPDATE news SET video_duration = 180 WHERE media_type = 'video' AND video_duration <= 0;
```

### é—®é¢˜4ï¼šå›¾ç‰‡URLæ— æ•ˆ

**ç°è±¡**ï¼šå¤šå›¾æ–°é—»æ˜¾ç¤ºç©ºç™½å›¾ç‰‡

**è§£å†³æ–¹æ¡ˆ**ï¼š
```sql
-- æ£€æŸ¥å›¾ç‰‡URL
SELECT 
    title,
    image_url,
    image_url_2,
    image_url_3
FROM news 
WHERE media_type = 'multi_image';

-- ç¡®ä¿URLæ ¼å¼æ­£ç¡®ï¼Œä¾‹å¦‚ï¼š
-- https://picsum.photos/400/200?random=51
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åº“ç´¢å¼•

```sql
-- åª’ä½“ç±»å‹ç´¢å¼•
CREATE INDEX idx_news_media_type ON news(media_type);

-- å¤åˆç´¢å¼•
CREATE INDEX idx_news_category_media_time ON news(category_id, media_type, publish_time);

-- åˆ†ç±»æŸ¥è¯¢ç´¢å¼•
CREATE INDEX idx_news_category_time ON news(category_id, publish_time DESC);
```

### 2. æŸ¥è¯¢ä¼˜åŒ–

```sql
-- é¿å…æŸ¥è¯¢ä¸å¿…è¦çš„å­—æ®µ
SELECT 
    title, summary, media_type,
    CASE media_type
        WHEN 'single_image' THEN image_url
        WHEN 'multi_image' THEN CONCAT(image_url, ',', IFNULL(image_url_2, ''), ',', IFNULL(image_url_3, ''))
        WHEN 'video' THEN video_cover_url
    END as display_image
FROM news;
```

### 3. ç¼“å­˜ç­–ç•¥

```java
// åœ¨Serviceå±‚æ·»åŠ ç¼“å­˜
@Cacheable(value = "news", key = "#categoryCode + '_' + #offset + '_' + #limit")
public List<NewsItem> getNewsList(String categoryCode, Integer offset, Integer limit) {
    return newsMapper.findAllNews(categoryCode, offset, limit);
}
```

---

## ğŸ”„ å‡çº§è·¯å¾„

### ä»æ—§ç‰ˆæœ¬å‡çº§

å¦‚æœä½ çš„æ•°æ®åº“æ˜¯æ—§ç‰ˆæœ¬ï¼ˆä¸æ”¯æŒå¤šåª’ä½“ï¼‰ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å‡çº§ï¼š

```sql
-- 1. å¤‡ä»½ç°æœ‰æ•°æ®
CREATE TABLE news_backup AS SELECT * FROM news;

-- 2. æ·»åŠ æ–°å­—æ®µ
ALTER TABLE news 
ADD COLUMN image_url_2 VARCHAR(255) DEFAULT NULL COMMENT 'ç¬¬äºŒå¼ å›¾ç‰‡URL',
ADD COLUMN image_url_3 VARCHAR(255) DEFAULT NULL COMMENT 'ç¬¬ä¸‰å¼ å›¾ç‰‡URL',
ADD COLUMN media_type VARCHAR(20) DEFAULT 'single_image' COMMENT 'åª’ä½“ç±»å‹',
ADD COLUMN video_url VARCHAR(255) DEFAULT NULL COMMENT 'è§†é¢‘URL',
ADD COLUMN video_duration INT DEFAULT 0 COMMENT 'è§†é¢‘æ—¶é•¿(ç§’)',
ADD COLUMN video_cover_url VARCHAR(255) DEFAULT NULL COMMENT 'è§†é¢‘å°é¢URL';

-- 3. æ›´æ–°ç°æœ‰æ•°æ®çš„åª’ä½“ç±»å‹
UPDATE news SET media_type = 'single_image' WHERE media_type IS NULL;

-- 4. éªŒè¯å‡çº§ç»“æœ
SELECT COUNT(*) FROM news WHERE media_type = 'single_image';
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [2.å¤šå›¾ç‰‡å’Œè§†é¢‘æ–°é—»æ”¯æŒ.md](../2.å¤šå›¾ç‰‡å’Œè§†é¢‘æ–°é—»æ”¯æŒ.md) - åŠŸèƒ½è¯¦ç»†è¯´æ˜
- [3.æœåŠ¡ç«¯æ•°æ®ä¸‹å‘é›†æˆè¯´æ˜.md](./3.æœåŠ¡ç«¯æ•°æ®ä¸‹å‘é›†æˆè¯´æ˜.md) - Spring Bootåç«¯æ­å»º
- [6.Roomæœ¬åœ°ç¼“å­˜é›†æˆè¯´æ˜.md](./6.Roomæœ¬åœ°ç¼“å­˜é›†æˆè¯´æ˜.md) - Androidæœ¬åœ°ç¼“å­˜

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.0 (2025-11-30)
- âœ… æ–°å¢å¤šå›¾æ–°é—»æ”¯æŒï¼ˆ2-3å¼ å›¾ç‰‡ï¼‰
- âœ… æ–°å¢è§†é¢‘æ–°é—»æ”¯æŒï¼ˆURLã€æ—¶é•¿ã€å°é¢ï¼‰
- âœ… æ–°å¢åª’ä½“ç±»å‹å­—æ®µï¼ˆsingle_image/multi_image/videoï¼‰
- âœ… æ›´æ–°APIå“åº”æ ¼å¼
- âœ… æ›´æ–°MyBatisæ˜ å°„é…ç½®
- âœ… æ–°å¢60+æ¡å¤šåª’ä½“æµ‹è¯•æ•°æ®
- âœ… ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•å»ºè®®

### v1.0 (2025-11-22)
- âœ… åŸºç¡€æ•°æ®åº“é›†æˆ
- âœ… å•å›¾æ–°é—»æ”¯æŒ
- âœ… åŸºç¡€APIæ¥å£

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2025-11-30  
**ä½œè€…**: Cascade AI Assistant
